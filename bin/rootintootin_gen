#!/usr/bin/env python2.6
# -*- coding: UTF-8 -*-
#-------------------------------------------------------------------------------
#
#    This file is part of the Rootin Tootin web framework and licensed under the
#    GPL version 2 or greater. See the COPYRIGHT file for copyright information.
#    This project is hosted at http://rootin.toot.in .
#
#-------------------------------------------------------------------------------

import os, sys
from lib_rootintootin import *

def print_usage():
	print "The gen script generates code, databases, and config files:"
	print ""
	print "./gen create noun [singular:user] [plural:users]"
	print "./gen create migration [name] [field:type] ..."
	print "./gen create scaffold [name] [field:type] ..."
	print "./gen migrate"
	print "./gen configure database [user:root] [password:password] [host:location] [name:db_name]"
	print "./gen configure server [port:number] [max_waiting_clients:number] [header_max_size:number]"
	print "./gen create database"
	print "./gen drop database"
	exit(1)

# Make sure the first arg is a path
if len(sys.argv) < 2:
	print_usage()
elif not os.path.exists(sys.argv[1]):
	print "The path '" + sys.argv[1] + "' does not exist. Exiting ..."
	exit(1)

# Move the path to the location of the original caller script
os.chdir(sys.argv[1])
generator = Generator()

# create database
if str.join(' ', sys.argv[2:]) == "create database":
	generator.create_database()

# drop database
elif str.join(' ', sys.argv[2:]) == "drop database":
	generator.drop_database()

# create migration [name] [field:type] ...
elif str.join(' ', sys.argv[2:4]) == "create migration":
	model_name = sys.argv[4]
	generator.check_pluralization(model_name)
	generator.create_migration(model_name, sys.argv[5:])

# create scaffold [name] [field:type] ...
elif str.join(' ', sys.argv[2:4]) == "create scaffold":
	controller_name = sys.argv[4]
	generator.check_pluralization(controller_name)
	generator.create_scaffold(controller_name, sys.argv[5:])
	generator.create_model(controller_name, sys.argv[5:])
	generator.create_migration(controller_name, sys.argv[5:])
	generator.configure_routes(controller_name, sys.argv[4:])

# migrate
elif str.join(' ', sys.argv[2:]) == "migrate":
	generator.migrate()

# configure database [user:root] [password:password] \
#						[host:location] [name:db_name]
elif str.join(' ', sys.argv[2:4]) == "configure database":
	generator.configure_database(sys.argv[4:])

# configure server [port:number] [max_waiting_clients:number] \
#					[header_max_size:number]
elif str.join(' ', sys.argv[2:4]) == "configure server":
	generator.configure_server(sys.argv[4:])

# create noun [singular:user] [plural:users]
elif str.join(' ', sys.argv[2:4]) == "create noun":
	generator.create_noun(sys.argv[4:])

else:
	print_usage()
'''
create model [name] [field:type] ...
drop model [name]
rename model [name] to [name]
alter model [name] name_of_migration

add field [field:type] to [name]
remove field [field] from [name]
rename field [field] to [field] from [name]
alter field [field] from [name] name_of_migration
'''
